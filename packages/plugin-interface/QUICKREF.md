# Quick Reference - @panini/plugin-interface

## üìÅ Structure

```
packages/plugin-interface/
‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îú‚îÄ‚îÄ index.ts              # Entry point
‚îÇ   ‚îú‚îÄ‚îÄ index.test.ts         # Tests (9 tests ‚úÖ)
‚îÇ   ‚îî‚îÄ‚îÄ types/
‚îÇ       ‚îú‚îÄ‚îÄ manifest.ts       # Plugin metadata
‚îÇ       ‚îú‚îÄ‚îÄ context.ts        # Runtime context
‚îÇ       ‚îú‚îÄ‚îÄ plugin.ts         # Main interface
‚îÇ       ‚îú‚îÄ‚îÄ events.ts         # Event system
‚îÇ       ‚îú‚îÄ‚îÄ config.ts         # Configuration
‚îÇ       ‚îî‚îÄ‚îÄ storage.ts        # Persistence
‚îú‚îÄ‚îÄ examples/
‚îÇ   ‚îú‚îÄ‚îÄ README.md             # Usage guide
‚îÇ   ‚îî‚îÄ‚îÄ example-plugin.ts     # Word Counter demo
‚îú‚îÄ‚îÄ dist/                     # Generated by tsc
‚îÇ   ‚îú‚îÄ‚îÄ index.js + .d.ts
‚îÇ   ‚îî‚îÄ‚îÄ types/*.js + .d.ts
‚îú‚îÄ‚îÄ package.json
‚îú‚îÄ‚îÄ tsconfig.json
‚îú‚îÄ‚îÄ README.md                 # Full API docs
‚îú‚îÄ‚îÄ ARCHITECTURE.md           # ASCII diagrams
‚îî‚îÄ‚îÄ LICENSE
```

## üöÄ Commands

### Development

```bash
cd packages/plugin-interface

# Install dependencies
npm install

# Build (TypeScript ‚Üí JavaScript + .d.ts)
npm run build

# Run tests
npm test

# Watch tests
npm run test:watch

# Coverage
npm run test:coverage

# Lint
npm run lint
```

### Validation

```bash
# Check syntax
node -c dist/index.js

# Verify types
tsc --noEmit

# All tests pass?
npm test
# ‚úÖ Expected: 9 passed (9)
```

### Publishing

```bash
# Version bump
npm version 0.1.0-alpha.1

# Publish to NPM (alpha tag)
npm publish --tag alpha

# Later: stable release
npm version 0.1.0
npm publish
```

## üìö Quick Links

| Resource                 | Location                                                                |
| ------------------------ | ----------------------------------------------------------------------- |
| **Main README**          | `packages/plugin-interface/README.md`                                   |
| **Examples**             | `packages/plugin-interface/examples/`                                   |
| **Architecture**         | `packages/plugin-interface/ARCHITECTURE.md`                             |
| **Tests**                | `packages/plugin-interface/src/index.test.ts`                           |
| **Integration Strategy** | `docs/PANINI_INTEGRATION_STRATEGY.md`                                   |
| **Phase 1.1 Summary**    | `docs/PHASE1_1_SUMMARY.md`                                              |
| **Journal de bord**      | `docs/journal-de-bord/2026-01-14_phase1-1-plugin-interface-complete.md` |

## üí° Common Tasks

### Create a new plugin

```typescript
import { PaniniPlugin, PaniniPluginContext } from "@panini/plugin-interface";

export default class MyPlugin implements PaniniPlugin {
  manifest = {
    id: "my-plugin",
    name: "My Plugin",
    version: "1.0.0",
  };

  async activate(context: PaniniPluginContext) {
    // Your logic here
  }

  async deactivate() {
    // Cleanup
  }
}
```

### Use in Pensine

```typescript
const context = {
  app: "pensine",
  version: "1.0.0",
  events: window.eventBus,
  config: window.modernConfigManager,
  storage: storageManager,
  features: { markdown: true, offline: true },
  logger: console,
};

const plugin = new MyPlugin();
await plugin.activate(context);
```

### Listen to events

```typescript
async activate(context: PaniniPluginContext) {
  // Always use namespace!
  context.events.on(
    'file:opened',
    async (data) => { /* handler */ },
    this.manifest.id  // ‚Üê Cleanup via clearNamespace
  );
}
```

### Register config schema

```typescript
context.config.registerSchema(
  this.manifest.id,
  {
    type: "object",
    properties: {
      enabled: { type: "boolean" },
      theme: { type: "string", enum: ["light", "dark"] },
    },
    required: ["enabled"],
  },
  {
    // Defaults
    enabled: true,
    theme: "light",
  }
);
```

### Read/write files

```typescript
// Read
const content = await context.storage.readFile("path/to/file.md");

// Write
await context.storage.writeFile("path/to/file.md", content, "Commit message");

// List
const files = await context.storage.listFiles("journals/");

// Check exists
const exists = await context.storage.fileExists("config.json");
```

## üéØ Standard Events

```typescript
// Listen to standard events
PaniniEvents.APP_READY; // 'app:ready'
PaniniEvents.PLUGIN_ACTIVATED; // 'plugin:activated'
PaniniEvents.FILE_OPENED; // 'file:opened'
PaniniEvents.FILE_SAVED; // 'file:saved'
PaniniEvents.MARKDOWN_RENDER; // 'markdown:render'
PaniniEvents.CONFIG_CHANGED; // 'config:changed'
PaniniEvents.UI_THEME_CHANGED; // 'ui:theme-changed'
// ... see src/types/events.ts for all
```

## üîç Debugging

### Check plugin state

```typescript
await plugin.healthCheck(); // ‚Üí true if active
```

### Log context

```typescript
async activate(context: PaniniPluginContext) {
  context.logger.info('Plugin activated on:', context.app);
  context.logger.info('Version:', context.version);
  context.logger.info('Features:', context.features);
}
```

### Validate config

```typescript
const result = context.config.validate(this.manifest.id, userConfig);

if (!result.valid) {
  context.logger.error("Invalid config:", result.errors);
}
```

## üìä Metrics

| Metric               | Value           |
| -------------------- | --------------- |
| **TypeScript files** | 9               |
| **Interfaces**       | 15+             |
| **Events**           | 12 standardized |
| **Tests**            | 9 (all pass ‚úÖ) |
| **Build time**       | < 1s            |
| **Test time**        | 882ms           |
| **Runtime deps**     | 0               |

## ‚ö†Ô∏è Important Rules

1. **Always use namespace** in event listeners

   ```typescript
   // ‚úÖ CORRECT
   context.events.on(event, handler, this.manifest.id);

   // ‚ùå WRONG (memory leak!)
   context.events.on(event, handler);
   ```

2. **Always provide config defaults**

   ```typescript
   // ‚úÖ CORRECT
   context.config.registerSchema(id, schema, {
     enabled: true, // Default
   });

   // ‚ùå WRONG (no defaults)
   context.config.registerSchema(id, schema);
   ```

3. **Always validate in activate()**

   ```typescript
   // ‚úÖ CORRECT
   async activate(context: PaniniPluginContext) {
     try {
       // Init
     } catch (error) {
       context.logger.error('Failed:', error);
       throw error; // Re-throw for plugin system
     }
   }
   ```

4. **Use optional methods correctly**

   ```typescript
   // ‚úÖ CORRECT (optional but type-safe)
   async onConfigChange?(config: any): Promise<void>;
   async healthCheck?(): Promise<boolean>;

   // Implementation is optional
   ```

## üîó External Resources

- **NPM**: `@panini/plugin-interface` (when published)
- **GitHub**: `https://github.com/panini-ecosystem/plugin-interface`
- **Docs**: `https://docs.panini.dev/plugin-interface`
- **Examples**: See `examples/` folder

## üÜò Troubleshooting

### Build fails

```bash
# Clean and rebuild
rm -rf dist node_modules
npm install
npm run build
```

### Tests fail

```bash
# Run with verbose
npm test -- --reporter=verbose

# Run single test
npm test -- --grep "should export all"
```

### Types not found

```bash
# Check dist/
ls -la dist/

# Should have index.d.ts
cat dist/index.d.ts
```

### Import errors

```typescript
// ‚úÖ CORRECT
import { PaniniPlugin } from "@panini/plugin-interface";

// ‚ùå WRONG
import { PaniniPlugin } from "./src/index";
```

---

**Version**: 0.1.0
**Status**: ‚úÖ Ready for integration
**Last updated**: 14 janvier 2026
